# oc-components_entPhysicalTable.yml
# SNMP: 
#   - ENTITY-MIB::entPhysicalTable
#   - ENTITY-STATE-MIB::entStateTable
# OC: /components/component/state
# Kentik-path: /components

# Profile intents to collect metadata and metrics about device components from SNMP ENTITY-MIB and ENTITY-SENSOR-MIB
# Trying to normalize metrics to openconfig-platform:/components model as much as possible

metrics:

  - MIB: /
    table:
      OID: .1.3.6.1.2.1.47.1.1.1    # ENTITY-MIB::entPhysicalTable
      name: components # /components
      # oc-path: /components/component/state

    symbols:

        # here just to have one metric
      - tag: components:fru
        OID: .1.3.6.1.2.1.47.1.1.1.1.16
        name: entPhysicalIsFRU

      # This info comes from ENTITY-STATE-MIB which might not be supported 
      - tag: components:admin-status
        OID: .1.3.6.1.2.1.131.1.1.1.2
        name: entStateAdmin    # ENTITY-STATE-MIB::entStateTable
        enum:
          unknown: 1
          locked: 2
          shuttingDown: 3
          unlocked: 4


      # This info comes from ENTITY-STATE-MIB which might not be supported 
      - tag: components:oper-status
        OID: .1.3.6.1.2.1.131.1.1.1.3
        name: entStateOper    # ENTITY-STATE-MIB::entStateTable
        enum: 
          unknown: 1
          disabled: 2
          enabled: 3
          testing: 4
        script: |
          def main(n):
            print("entStateOper")
            print(n)
            return None


    metric_tags:
      - tag: components:name
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.2
          name: entPhysicalDescr

      # entPhysicalVendorType is the OID reference to the Vendor MIBs
      # to many moving components to track for now
      #- tag: components:vendor_type
      #  column:
      #    OID: .1.3.6.1.2.1.47.1.1.1.1.3
      #    name: entPhysicalVendorType
          
      - tag: components:parent
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.4
          name: entPhysicalContainedIn
          
      - tag: components:type
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.5
          name: entPhysicalClass
          enum:
            other: 1
            unknown: 2
            chassis: 3
            backplane: 4
            container: 5
            powerSupply: 6
            fan: 7
            sensor: 8
            module: 9
            port: 10
            stack: 11
            cpu: 12

      - tag: components:parent-position    # not in openconfig
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.6
          name: entPhysicalParentRelPos
          
      - tag: components:description
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.7
          name: entPhysicalName
          
      - tag: components:hardware-version
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.8
          name: entPhysicalHardwareRev
          
      - tag: components:firmware-version
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.9
          name: entPhysicalFirmwareRev
          
      - tag: components:software-version
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.10
          name: entPhysicalSoftwareRev
          
      - tag: components:serial-no
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.11
          name: entPhysicalSerialNum
        
      - tag: components:mfg-name
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.12
          name: entPhysicalMfgName
          
      - tag: components:model
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.13
          name: entPhysicalModelName

      - tag: components:removable
        column:
          OID: .1.3.6.1.2.1.47.1.1.1.1.16
          name: entPhysicalIsFru
          enum:
            "true": 1
            "false": 2

      # not used        
      # - tag: components:alias
      #   column:
      #     OID: .1.3.6.1.2.1.47.1.1.1.1.14
      #     name: entPhysicalAlias
          
      # - tag: components:asset_id
      #   column:
      #     OID: .1.3.6.1.2.1.47.1.1.1.1.15
      #     name: entPhysicalAssetID
          

