# sysDescr examples from Juniper devices:
# 
# Juniper Networks, Inc. qfx5100-48s-6q Ethernet Switch, kernel JUNOS 14.1X53-D40.8, Build date: 2016-11-09 02:17:36 UTC Copyright (c) 1996-2016 Juniper Networks, Inc.
# Juniper Networks, Inc. JNP204 [MX204] internet router, kernel JUNOS 17.4R2.4, Build date: 2018-08-17 02:23:20 UTC Copyright (c) 1996-2018 Juniper Networks, Inc.
# Juniper Networks, Inc. mx104 internet router, kernel JUNOS 13.3R9.13, Build date: 2016-03-01 09:06:52 UTC Copyright (c) 1996-2016 Juniper Networks, Inc.
# Juniper Networks, Inc. mx80-48t internet router, kernel JUNOS 13.3R9.13, Build date: 2016-03-01 09:06:52 UTC Copyright (c) 1996-2016 Juniper Networks, Inc.
# Juniper Networks, Inc. qfx5100-24q-2p Ethernet Switch, kernel JUNOS 14.1X53-D35.3, Build date: 2016-02-29 23:39:06 UTC Copyright (c) 1996-2016 Juniper Networks, Inc.


# lldpLocSysDesc examples:
# Juniper MX104 Internet Backbone Router
# Juniper Virtual Chassis Switch
# Juniper Networks, Inc. qfx5100-48s-6q Ethernet Switch, kernel JUNOS 14.1X53-D40.8, Build date: 2016-11-09 02:17:36 UTC Copyright (c) 1996-2016 Juniper Networks, Inc.
# Juniper Networks, Inc. mx80-48t , version 13.3R9.13 Build date: 2016-03-01 08:36:50 UTC 
# Juniper Networks, Inc. JNP204 [MX204] internet router, kernel JUNOS 17.4R2.4, Build date: 2018-08-17 02:23:20 UTC Copyright (c) 1996-2018 Juniper Networks, Inc.


---
extends:
  # Generic MIB2 profiles
  - if-mib.yml
  - system-mib.yml

  # Normalized from standard MIBs to Kentik OC data models
  - oc-system-uptime.yml
  - oc-lldp.yml
  - oc-ospf.yml
  - oc-address-ipv4_ipAddrTable.yml
  - oc-address-ipv6_ipv6AddrTable.yml
  # - oc-components_entPhysicalTable.yml           # can be enabled if Juniper device supports ENTITY-MIB
  # - oc-components-sensor_entPhySensorTable.yml   # can be enabled if Juniper device supports ENTITY-SENSOR-MIB

  # Juniper to OC
  - juniper-oc-components.yml
  - juniper-oc-components-cpu.yml
  - juniper-oc-components-memory.yml
  - juniper-oc-components-temperature.yml
  - juniper-oc-bgp.yml

sysobjectid:
  - 1.3.6.1.4.1.2636.1.1.1.*


metric_tags:

  # Tags that go into 'default' measurement name used for general device metadata
  # Special parsing of the sysDescr to extract additional metadata
  - column:
      OID: .1.3.6.1.2.1.1.1.0
      name: juniper:description
      #conversion: "regexp:(?P<sysDescr>(?P<vendor>Juniper Networks), Inc\\. (?P<model>\\S+).*kernel (?P<os_name>\\S+).*\\s(?P<os_version>[\\w\\-]+\\.[\\w\\-]+\\.[\\w\\-]+).*)"
      conversion: 'regexp:(?P<sysDescr>(?P<vendor>Juniper Networks), Inc\. (?P<model>\S+).*kernel (?P<os_name>\S+).*\s(?P<os_version>[\w\-]+\.[\w\-]+\.?[\w\-]+).*)'
  # Vendor specific OIDS
  - column:
      OID: .1.3.6.1.4.1.2636.3.1.3.0
      name: serial_number
  - column:
      OID: .1.3.6.1.4.1.2636.3.1.2.0
      name: product_name


metrics:

# # this is something that can be Kentik proprietary
#   - MIB: "/kentik:device"
#     table:
#       OID: 1.3.6.1.4.1.999999.2636
#       name: system
#     symbols:
#       # - tag: kentik-device:uptime-sec
#       #   OID: 1.3.6.1.6.3.10.2.1.3.0
#       #   name: snmpEngineTime

#       - tag: kentik-device:temperature
#         OID: 1.3.6.1.4.1.2636.3.1.13.1.7.9.1.0.0
#         name: jnxOperatingTemp

#       - tag: kentik-device:cpu-utilization
#         OID: 1.3.6.1.4.1.2636.3.1.13.1.8.9.1.0.0
#         name: jnxOperatingCPU

#       - tag: kentik-device:memory-utilizaton
#         OID: 1.3.6.1.4.1.2636.3.1.13.1.11.9.1.0.0
#         name: jnxOperatingBuffer

# # This is general oc-path /system
#   - MIB: "/"
#     table:
#       OID: 1.3.6.1.4.1.999999.2636.2
#       name: "system"
#     symbols:
#       - tag: oc-system:uptime-sec
#         OID: .1.3.6.1.6.3.10.2.1.3
#         name: snmpEngineTime
#         # Adding boot-time in nanosec
#         script: |
#           load('math.star', 'math')
#           def main(n):
#             n["boot-time"] = int(float(n["oc-system:uptime-sec"] * math.pow(10, 9)))
#             return None

# This is a single CPU utilization metrics
# oc-path: openconfig-system:/system/cpus/cpu[index="ALL"]/state/total/instant
# The "cpu" with index="ALL" gives values across all the CPUs or CPU cores
  - MIB: "/system"
    table:
      OID: 1.3.6.1.4.1.999999.2636.3
      name: "cpus"
    symbols:
      - tag: oc-cpus:total/instant
        OID: .1.3.6.1.4.1.2636.3.1.13.1.8.9.1.0.0
        name: jnxOperatingCPU
    metric_tags:
      - column:
          name: cpu_index
          OID: 1.3.6.1.6.3.1135.6169.ALL
      - column:
          name: index
          OID: 1.3.6.1.6.3.1135.6169.0

# This is a single memory info
# OC paths for memory, no path for utilization
# oc-path: openconfig-system:/system/memory/state/physical
# oc-path: openconfig-system:/system/memory/state/reserved
# oc-path: openconfig-system:/system/memory/state/used
# oc-path: openconfig-system:/system/memory/state/free
  - MIB: "/system"
    table:
      OID: 1.3.6.1.4.1.999999.2636.4
      name: "memory"
    symbols:
      - tag: oc-memory:utilization
        OID: .1.3.6.1.4.1.2636.3.1.13.1.11.9.1.0.0
        name: jnxOperatingBuffer
    metric_tags:
      - column:
          name: index
          OID: 1.3.6.1.6.3.1135.6169.0
  #   metric_tags:
  #     - column:
  #         OID: .1.3.6.1.2.1.1.5
  #         name: hostname
  #     - column:
  #         OID: .1.3.6.1.2.1.1.6
  #         name: location
  #     - column:
  #         OID: .1.3.6.1.2.1.1.2
  #         name: sys-object-id
  #         allow_duplicate: true
  #     - column:
  #         OID: .1.3.6.1.2.1.1.1
  #         name: test_description
  #         #conversion: "regexp:(?P<asdasdasdsa>(?P<vendor>Juniper Networks), Inc\\. (?P<model>\\S+).*kernel (?P<os_name>\\S+).*\\s(?P<os_version>[\\w\\-]+\\.[\\w\\-]+\\.[\\w\\-]+).*)"
  #         #conversion: "regexp:(?P<os_name>JUNOS)"
  #     - column:
  #         OID: .1.3.6.1.6.3.10.2.1.1
  #         name: blabhsadasdas
  #     # Vendor specific OIDS
  #     - column:
  #         OID: .1.3.6.1.4.1.2636.3.1.3
  #         name: serial-number
  #     - column:
  #         OID: .1.3.6.1.4.1.2636.3.1.2
  #         name: product-name

  # - column:
  #     OID: .1.0.8802.1.1.2.1.3.4.0
  #     name: lldpLocSysDesc
  #     #conversion: "regexp: ([\\w\\-]+\\.[\\w\\-]+\\.[\\w\\-]+)"
  #     conversion: "regexp:(?P<os_name>JUNOS)?\\s+(?P<os_version>[\\w\\-]+\\.[\\w\\-]+\\.[\\w\\-]+)"
  #     allow_duplicate: true
#  - column:
#      OID: 1.3.6.1.2.1.1.1.0
#      name: sysDescr
#      allow_duplicate: true
#      conversion: "regexp:kernel\\s+(?P<os_name>\\S+?)\\s+(?P<os_version>\\S+)"
  # - column:
  #     OID: .1.0.8802.1.1.2.1.3.4.0
  #     name: os_name
  #     conversion: "regexp: kernel\\s+(\\w+)\\s+[\\w\\.\\-]+,"
  #     allow_duplicate: true
